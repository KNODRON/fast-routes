
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Rutas R√°pidas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #ffffff;
            color: #003b1f;
            padding: 20px;
            text-align: center;
        }

        h1 {
            color: #005131;
        }

        .main-button {
            display: block;
            width: 80%;
            max-width: 400px;
            margin: 10px auto;
            padding: 15px;
            font-size: 18px;
            background-color: #00754a;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }

        #searchInput {
            padding: 10px;
            font-size: 16px;
            margin: 15px auto;
            width: 80%;
            max-width: 400px;
            border: 2px solid #00754a;
            border-radius: 6px;
        }

        .unidad {
            background: #e3f7ef;
            margin: 10px auto;
            border: 1px solid #00754a;
            border-radius: 8px;
            padding: 10px;
            max-width: 90%;
            cursor: pointer;
            font-weight: bold;
        }

        .subunidad {
            background: #f4fcfa;
            margin: 4px auto 4px 40px;
            border-left: 4px solid #00754a;
            padding: 5px;
            max-width: 80%;
            text-align: left;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Rutas R√°pidas</h1>
    <button class="main-button" onclick="toggleComisarias()">üëÆ‚Äç‚ôÇÔ∏è Comisar√≠as</button>
    <button class="main-button" onclick="openUrgencias()">üöë Urgencias</button>
    <button class="main-button" onclick="openEmergencia()">üÜò Emergencia</button>

    <div id="comisariasContainer" class="hidden">
        <input type="text" id="searchInput" placeholder="üîç Buscar comisar√≠a, tenencia o reten..." onkeyup="filtrarUnidades()"/>
        <div id="unidadesList"></div>
    </div>

    <script>
        let data = {};
        async function toggleComisarias() {
            const cont = document.getElementById("comisariasContainer");
            cont.classList.toggle("hidden");

            if (!data.unidades) {
                const res = await fetch("https://raw.githubusercontent.com/KNODRON/fast-routes/main/unidades_carabineros_jerarquico.json");
                data.unidades = await res.json();
                renderUnidades(data.unidades);
            }
        }

        function renderUnidades(unidades) {
            const container = document.getElementById("unidadesList");
            container.innerHTML = "";

            unidades.forEach((unidad, index) => {
                const div = document.createElement("div");
                div.className = "unidad";
                div.textContent = unidad.nombre;
                div.onclick = () => {
                    const hijos = document.getElementById("sub_" + index);
                    hijos.classList.toggle("hidden");
                };

                container.appendChild(div);

                if (unidad.subunidades) {
                    const subDiv = document.createElement("div");
                    subDiv.className = "hidden";
                    subDiv.id = "sub_" + index;

                    unidad.subunidades.forEach(sub => {
                        const s = document.createElement("div");
                        s.className = "subunidad";
                        s.textContent = sub.nombre;
                        s.onclick = (e) => {
                            e.stopPropagation();
                            window.open("https://www.google.com/maps/place/" + sub.coords, "_blank");
                        };
                        subDiv.appendChild(s);
                    });

                    container.appendChild(subDiv);
                }
            });
        }

        function filtrarUnidades() {
            const texto = document.getElementById("searchInput").value.toLowerCase();
            const todas = document.querySelectorAll(".unidad, .subunidad");
            todas.forEach(el => {
                if (el.textContent.toLowerCase().includes(texto)) {
                    el.style.display = "block";
                } else {
                    el.style.display = "none";
                }
            });
        }

        function openUrgencias() {
            window.open("https://www.google.com/maps/search/?api=1&query=SAR", "_blank");
        }

        function openEmergencia() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    const lat = pos.coords.latitude;
                    const lng = pos.coords.longitude;
                    window.open(`https://www.google.com/maps/search/hospital+de+urgencia/@${lat},${lng},14z`, "_blank");
                }, () => {
                    window.open("https://www.google.com/maps/search/?api=1&query=hospital+de+urgencia+Santiago", "_blank");
                });
            } else {
                window.open("https://www.google.com/maps/search/?api=1&query=hospital+de+urgencia+Santiago", "_blank");
            }
        }
    </script>
</body>
</html>
